### 작성자 : 박민지
<br>

# Injection
> `DB를 비정상적으로 조작하는 기법`<br>
> 코드 인덱션의 한 기법으로 클라이언트 입력값을 조작하여 서버의 DB를 공격할 수 있는 공격 방식을 말한다.

- SQL 삽입, SQL 주입으로도 불린다
- **주로 사용자가 입력한 데이터를 서버 측에서 제대로 필터링/이스케이필 하지 못한 경우 발생한다**
<br>

### Q. 웹 페이지의 SQL
> SQL Injection은 일반적으로 사용자 이름, ID와 같은 입력을 요청할 때 발생한다.

##### - 사용자가 입력한 SQL
```
txtUserId = getRequestString("UserId"); 
txtSQL = "SELECT *
          FROM Users 
          WHERE UserId = " + txtUserId;
```
##### - 공격자가 주입한 SQL
```
SELECT *
FROM Users
WHERE UserId = 105 OR 1=1;
```

- 공격자가 UserId필드에 `105 OR 1=1`을 입력한다
- 해당 쿼리는 UserId="105"인 사용자 뿐만 아니라 **모든 사용자의 데이터를 반환**하게 된다
- 따라서 Users 테이블의 모든 정보를 조회하게 됨으로써 가장 먼저 만들어진 계정으로 로그인에 성공한다
- 보통 관리자 계정을 처음에 만들기 때문에 관리자 계정을 탈취한 공격자가 권한을 악용할 수 있다
<br>

### Q. SQL Injection 유형

#### 1. 인증 우회
> 로그인 폼(form)을 대상으로 공격을 수행한다. 정상적인 계정 정보가 없어도 로그인을 우회하여 인증 획득이 가능하다. 즉, Where 구문을 우회한다

[예제 1]
```
SELECT * FROM Users WHERE userId='admin' #AND password='';
```
- 의도적으로 주석을 삽입하여 Where 조건을 무력화한다

[예제 2]
```
SELECT * FROM Users WHERE name='ming-taro' AND password='123' OR '1'='1';
```
- 항상 참이되도록 구성하여 Where 조건을 무력화한다
- 쿼리의 결과가 무조건 참이 되어 없는 계정과 잘못된 비밀번호라도 인증을 통과한다
<br>

#### 2. 데이터 노출
> 조작된 쿼리가 실행되도록 하여 기업의 개인정보에 접근하여 데이터를 획득한다. 또는 데이터 값을 변경하거나 테이블을 삭제할 수도 있다.

> 시스템에서 발생하는 에러 메세지를 이용해 공격을 수행한다. 공격자는 악의적인 구문을 삽입하여 에러를 유발시킨다.

#### 3. 시스템 명령어 실행
> 일부 DB는 확장 프로시저를 호출해 원격으로 시스템 명령어를 수행할 수 있도록 한다. 시스템 명령어를 실행할 수 있다면 해당 서버의 모든 자원에 접근하고, 데이터를 유출/삭제할 수 있다.


### Q. Injection 방어
#### 1. input 값을 받을 때 특수문자 여부를 검사한다

#### 2. SQL 서버 오류 발생 시, 해당하는 에러 메세지를 감춘다

#### 3. Prepared Statement 구문을 사용한다
