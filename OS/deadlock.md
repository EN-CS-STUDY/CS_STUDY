### 작성자 : 홍영환

# 데드락 (DeadLock)



> 💡 컴퓨터 시스템에서 여러 프로세스나 스레드가 서로 자원을 기다리면서 **무한정 대기 상태**에 빠지는 현상을 의미한다.



데드락이 발생하면 해당 자원을 사용하는 모든 프로세스가 계속해서 대기 상태에 머물게 되어 시스템이 더 이상 진행할 수 없는 상태가 됩니다.

## 📚 데드락이 일어나는 경우

![Untitled](https://github.com/EN-CS-STUDY/CS_STUDY/assets/77156858/fb143444-0c57-47c5-8215-2c5a88235111)

프로세스1과 2가 자원1, 2를 모두 얻어야 한다고 가정해보자

t1 : 프로세스1이 자원1을 얻음 / 프로세스2가 자원2를 얻음

t2 : 프로세스1은 자원2를 기다림 / 프로세스2는 자원1을 기다림

→ 현재 서로 원하는 자원이 상대방에 할당되어 있어서 두 프로세스는 무한정 wait 상태에 빠짐

## 📚 데드락(DeadLock) 발생조건



> 💡 4가지 모두 성립해야 데드락이 발생한다.



### ✅ 상호 배제 (Mutual Exclusion)

- 자원은 한번에 하나의 프로세스만 사용할 수 있어야 한다.

### ✅ 점유와 대기 (Hold and Wait)

- 이미 자원을 점유하고 있는 프로세스가 다른 자원을 추가로 요청하며, 그 자원이 할당될 때까지 대기 상태에 있는 프로세스가 존재해야 한다.

### ✅ 비선점 (Non-preemption)

- 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없다.

### ✅ 순환 대기 (Circular Wait)

- 프로세스의 집합에서 순환 형태로 자원을 대기하고 있어야 한다.

예를 들어, P1 프로세스가 P2 프로세스의 자원을 기다리고, P2는 P3의 자원을 기다리며, P3는 다시 P1의 자원을 기다리는 상황이 발생해야 한다.

# 📚 데드락 (DeadLock) 해결 방법


### ✅ 1. 데드락 예방 (Prevention)

> 교착 상태 발생 조건 중 하나 이상을 만족하지 않도록 시스템을 설계한다. (자원 낭비 심함)
> 
- **상호 배제(Mutual Exclusion) 조건 제거**


> 💡 자원을 공유 모드로 만들어 여러 프로세스가 동시에 접근할 수 있게 한다.

하지만, 상호 배제가 필요한 자원(예: 프린터, 파일 등)에 대해선 상호 배제를 제거할 수 없으므로 이 방법은 실질적으로 어려운 경우가 대부분이다.

- **점유와 대기(Hold and Wait) 조건 제거**


> 💡 모든 자원을 한꺼번에 요청한다. (프로세스 실행 전 모든 자원 할당)



프로세스가 실행을 시작하기 전에 필요한 모든 자원을 한꺼번에 요청하고, 모든 자원이 할당될 때까지 기다리게 한다.

- **비선점(No Preemption) 조건 제거**


> 💡 자원을 요청하는 프로세스가 필요한 자원을 얻지 못하면, 점유하고 있는 다른 자원을 강제로 선점하여 다른 프로세스에게 할당한다.



즉, 모든 자원을 가질 수 있을 때만 자원을 할당받을 수 있다.

- **순환 대기(Circular Wait) 조건 제거 ( 가장 많이 사용 )**


> 💡 자원 유형에 순서를 부여하고 프로세스가 자원을 요청할 때 그 순서대로 요청하도록 한다.



자원 유형에 고유 번호를 매기고, 프로세스가 자원을 요청할 때 고유 번호가 작은 자원부터 순서대로 요청하게 한다. 

이렇게 하면 자원 사이의 순환 대기가 발생하지 않습니다.

예를 들어, 자원 A, B, C가 있고, 프로세스는 항상 A를 먼저 요청한 다음 B, 그리고 C를 요청하도록 한다.

### ✅ 2. 데드락 회피 (Avoidance)

> 자원 할당 시, 시스템이 안전 상태에 있는지 여부를 확인하여 데드락을 회피한다.
> 

**✏️ 은행원 알고리즘 (Banker’s Algorithm)**

- 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는데서 유래함
- 프로세스가 자원을 요구할 때, 시스템은 자원을 할당한 후에도 안정 상태로 남아있게 되는지 사전에 검사하여 교착 상태 회피
- 안정 상태면 자원 할당, 아니면 다른 프로세스들이 자원 해지까지 대기

**🌟 시스템 안정 상태(Safe State)에 있다는 의미는?**

- 모든 프로세스가 순차적으로 자원을 할당받아 작업을 완료하고 자원을 반납할 수 있는 상태를 말한다.

**알고리즘 동작**

1. **자원 요청**: 프로세스가 자원을 요청한다.
2. **요청 검증**: 시스템은 요청된 자원의 수가 최대 요구량을 초과하지 않는지 확인한다. 만약 초과하면 요청을 거부한다.
3. **안전성 검사**: 요청을 임시로 할당한 후 시스템이 안전 상태인지 확인한다.
- 현재 가용 자원을 업데이트한다.
- 프로세스의 필요 자원 수를 업데이트한다.
- 안전 상태를 확인하기 위해 모든 프로세스가 자신의 필요 자원을 충족할 수 있는지 검사한다.
1. **자원 할당**: 안전 상태라면 요청된 자원을 할당하고, 그렇지 않으면 요청을 거부한다.

**✏️ 자원 할당 그래프 알고리즘(Resource-Allocation Graph Algorithm)**

- 자원과 프로세스에 대해 요청 간선과 할당 간선을 적용하여 교착 상태를 회피하는 알고리즘
- 프로세스가 자원을 요구 시 요청 간선을 할당 간선으로 변경 했을 시 사이클이 생성 되는지 확인한다
- 사이클이 생성된다 하여 무조건 교착상태인 것은 아니다
    
    > 자원에 하나의 인스턴스만 존재 시 교착 상태로 판별한다. 자원에 여러 인스턴스가 존재 시 교착 상태 가능성으로 판별한다
    > 
- 사이클을 생성하지 않으면 자원을 할당한다

### ✅ 3. 데드락 탐지 및 회복(Detection And Recovery)

> 자원 할당 그래프를 통해 교착 상태를 탐지한다.
> 

주기적으로 시스템 상태를 검사하여 데드락이 발생했는지 탐지하고, 데드락이 발생한 경우 이를 해소하기 위한 조치를 취한다. 예를 들어, 프로세스를 강제로 종료하거나 자원을 회수하는 방법이 있다.

**프로세스 종료 방법**

- 교착 상태의 프로세스를 모두 중지
- 교착 상태가 제거될 때까지 하나씩 프로세스 중지

**자원 선점 방법**

- 교착 상태의 프로세스가 점유하고 있는 자원을 선점해 다른 프로세스에게 할당 (해당 프로세스 일시정지 시킴)
- 우선 순위가 낮은 프로세스나 수행 횟수 적은 프로세스 위주로 프로세스 자원 선점

**주요 질문**

1. 데드락(교착 상태)가 뭔가요? 발생 조건에 대해 말해보세요.
2. 회피 기법인 은행원 알고리즘이 뭔지 설명해보세요.
3. 기아상태를 설명하는 식사하는 철학자 문제에 대해 설명해보세요.

### 📚 참고문헌

[GitHub - gyoogle/tech-interview-for-developer: 👶🏻 신입 개발자 전공 지식 & 기술 면접 백과사전 📖](https://github.com/gyoogle/tech-interview-for-developer?tab=readme-ov-file)

[[OS] DeadLock(데드락)](https://peonyf.tistory.com/entry/OS-DeadLock데드락)

https://github.com/devSquad-study/2023-CS-Study/blob/main/OS/os_deadLock.md