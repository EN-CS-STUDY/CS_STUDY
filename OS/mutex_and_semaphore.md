### 작성: 홍영환

# **뮤텍스(Mutex)와 세마포어(Semaphore)**

---

프로세스 간 메시지를 전송하거나, 공유메모리를 통해 공유된 자원에 여러 개의 프로세스가 동시에 접근하면 **Critical Section**, **race condition(경쟁상태)** 이 발생할 수 있다.

### 🥲 문제발생

1. **일관성 없는 데이터** : 두 개 이상의 스레드가 동시에 공유 자원을 변경하거나 읽을 때 서로 다른 데이터를 읽게되어 다른 정보를 제공 받을 수 있따.
2. **데드락(deadlock)** : 두 개 이상의 스레드가 서로 다른 자원을 점유하고, 서로 상대방의 자원을 기다릴 때 **교착상태**가 발생할 수 있다.
3. **성능 저하** : 스레드간의 경쟁 상황으로 성능이 저하된다.

이를 해결하기 위해 데이터를 한 번에 하나의 프로세스만 접근할 수 있도록 제한을 두는 **동기화 방식**을 취해야 한다.

동기화 도구에는 대표적으로 **뮤텍스(Mutex)** 와 **세마포어(Semaphore)** 가 있다.

모두 공유된 자원의 데이터를 여러 스레드/프로세스가 접근하는 것을 막는 역할을 한다.

### **📚 Critical Section**

Critical Section은 (임계구역 또는 공유변수 영역) 병렬프로그래밍에서 둘 이상의 스레드 (멀티스레드)가 동시에 접근해서는 안되는 공유 자원(파일, 입출력, 공유 데이터 등) 을 접근하는 명령문 또는 코드의 일부 영역을 말한다.

## 📚 임계 영역(Critical Section)

---

여러 프로세스가 데이터를 공유하며 수행될 때, **각 프로세스에서 공유 데이터를 접근하는 프로그램 코드 블록**. 

즉, 여러 프로세스가 동일 자원을 동시에 참조하여 값(공유하는 변수명, 파일 등)이 오염될 위험 가능성이 있는 영역 프로그래밍 시, 성능 향상을 위해 임계영역을 최소화하는 설계를 해야 한다.

## 📚 뮤텍스(Mutex)

---

> 동시 프로그래밍에서 공유 불가능한 자원의 동시 사용을 피하기 위해 사용하는 알고리즘.
> 

**뮤텍스**는 상호 배제(**상호배체 Mutual Exclution)의 줄임말 이다.**

**뮤텍스**는 **이진(Binary) 세마포어** 이기도 하다.

- 임계구역(Critical Section)을 가진 스레드들의 실행시간이 서로 겹치치 않고 각각 단독으로 실행되도록 하는 기술
- 한 프로세스에 의해 소유될 수 있는 Key를 기반으로 한 상호배제 기법 (Key에 해당하는 어떤 객체(Object)가 있으며, 이 객체를 소유한 스레드/프로세스만이 공유자원에 접근할 수 있다.
- 다중 프로세스들의 공유 리소스에 대한 접근을 조율하기 위해 동기화(Synchronization) 또는 락(Lock)을 사용한다.
- 즉,  뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다.

![image](https://github.com/EN-CS-STUDY/CS_STUDY/assets/77156858/5a5b6869-b25a-4d9d-89dd-404839b41291)

## 📚 세마포어(Semaphore)

---

> 멀티 프로그래밍 환경에서 공유된 자원에 대한 접근을 제한하는 방법
> 

### 공유자원의 상태를 나타낼 수 있는 카운터로 생각할 때,

- 사용하고 있는 스레드/프로세스의 수를 공통으로 관리하는 하나의 값을 이용해 상호배제를 달성한다.
- 운영체제 또는 커널의 한 지정된 저장장치 내의 값
- 일반적으로 비교적 긴 시간을 확보하는 리소스에 대한 이용
- 유닉스 프로그래밍에서 세마포어는 운영체제의 리소스를 경쟁적으로 사용하는 다중 프로세스에서 행동을 조정하거나 또는 동기화하는 기술

- 공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근할 수 있다.
- 각 프로세스는 세마포어의 값을 확인하고 변경할 수 있다.
- 자원을 사용하지 않는 상태가 될 때, 대기하던 프로세스가 즉시 자원을 사용한다.
- 이미 다른 프로세스에 의해 사용중이라는 사실을 알게 되면, 재시도 전에 일정시간 대기해야 한다.
- 세마포어를 사용하는 프로세스는 그 값을 확인하고, 자원을 사용하는 동안에는 그 값을 변경함으로써 다른 세마포어 사용자들이 대기하도록 해야 한다.
- 세마포어는 이진수를 사용하거나 추가적인 값을 가질 수 있다.

![inage](https://github.com/EN-CS-STUDY/CS_STUDY/assets/77156858/c3beb776-bec8-4d52-b44e-71cc3202eaee)

## 🤔 뮤텍스와 세마포어의 차이점?

---

### ✅ 동기화 대상의 갯수 차이

- 뮤텍스(Mutex)는 동기화 대상이 오직 1개일 때 사용.
- 세마포어(Semaphore)는 동기화 대상이 1개 이상일 때 사용.

### ✅ 락(Lock) 해제의 차이

- Mutex는 소유하고 있는 스레드만이 이 Mutex를 해제할 수 있다.
- Semaphore는 Semaphore를 소유하지 않는 스레드가 Semaphore를 해제할 수 있다.

### ✅ 존재 위치의 차이

- Semaphore는 시스템 범위에 걸쳐 있고, 운영체제나 커널에 저장되고 변경된다.
- 반면, Mutex는 프로세스의 범위를 가지며 프로세스 종료 시 자동 제거된다.

 아래 사이트에서 차이점을 명확하게 그림으로 나타내고 있다 👍 <br/>
 https://worthpreading.tistory.com/90

### 📌 정리

---

- **뮤텍스**는 한 번에 하나의 스레드만이 자원에 접근하도록 하는 반면, **세마포어**는 여러 스레드가 동시에 자원에 접근할 수 있도록 합니다.
- **뮤텍스**는 소유권이 필요하지만, **세마포어**는 소유권 개념이 없습니다.
- **뮤텍스**는 보통 바이너리 상태(잠금/해제)를 가지지만, **세마포어**는 초기화된 값에 따라 다중 상태를 가질 수 있습니다.

## 📚 참고문헌

---

- https://chelseashin.tistory.com/40
- https://worthpreading.tistory.com/90